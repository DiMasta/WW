#include <iostream>
#include <string>
#include <vector>
#include <algorithm>
#include <cmath>
#include <stdio.h>
#include <string.h>
#include <math.h>
#include <climits>
#include <ctime>

using namespace std;

const char* MOVE_BUILD_ACTION = "MOVE&BUILD";

const int INVALID_COORD = -1;
const int INVALID_INDEX = -1;

enum Direction {
	INVALID_DIR = -1,
	N = 0,
	NE,
	E,
	SE,
	S,
	SW,
	W,
	NW
};

//-------------------------------------------------------------------------------------------------------------
//-------------------------------------------------------------------------------------------------------------
//-------------------------------------------------------------------------------------------------------------

class Coords {
public:
	Coords();
	Coords(int xCoord, int yCoord);

	int getXCoord() const { return xCoord; }
	int getYCoord() const { return yCoord; }

	void debug() const;
private:
	int xCoord;
	int yCoord;
};

//*************************************************************************************************************
//*************************************************************************************************************

Coords::Coords() :
	xCoord(INVALID_COORD),
	yCoord(INVALID_COORD)
{
}

//*************************************************************************************************************
//*************************************************************************************************************

Coords::Coords(
	int xCoord,
	int yCoord
) :
	xCoord(xCoord),
	yCoord(yCoord)
{
}

//*************************************************************************************************************
//*************************************************************************************************************

void Coords::debug() const {
	cerr << "Position: X=" << xCoord << ", Y=" << yCoord << endl;
}

//-------------------------------------------------------------------------------------------------------------
//-------------------------------------------------------------------------------------------------------------
//-------------------------------------------------------------------------------------------------------------

class Action {
public:
	Action();

	void filldata(const char* type, const char* moveDir, const char* buildDir);

	void debug() const;

private:
	const char* type;
	const char* moveDir;
	const char* buildDir;
};

//*************************************************************************************************************
//*************************************************************************************************************

Action::Action() :
	type(""),
	moveDir(""),
	buildDir("")
{
}

//*************************************************************************************************************
//*************************************************************************************************************

void Action::filldata(const char* type, const char* moveDir, const char* buildDir) {
	this->type = type;
	this->moveDir = moveDir;
	this->buildDir = buildDir;
}

//*************************************************************************************************************
//*************************************************************************************************************

void Action::debug() const {
	cerr << "Type=" << type << endl;
	cerr << "Move dir=" << moveDir << endl;
	cerr << "Build dir=" << buildDir << endl;
}

//-------------------------------------------------------------------------------------------------------------
//-------------------------------------------------------------------------------------------------------------
//-------------------------------------------------------------------------------------------------------------

class Unit {
public:
	Unit();

	Coords getPosition() const {
		return position;
	}

	int getLegalActionsCount() const {
		return legalActionsCount;
	}

	Action* getLegalActions() const {
		return legalActions;
	}

	void setPosition(Coords position) { this->position = position; }
	void setLegalactionsCount(int legalActionsCount) { this->legalActionsCount = legalActionsCount; }
	void setLegalActions(Action* legalActions) { this->legalActions = legalActions; }

	void initLegalactions(int legalActionsCount);
	void fillActionData(int actionIdx, const char* type, const char* moveDir, const char* buildDir);

	void debug() const;

private:
	Coords position;
	int legalActionsCount;
	Action* legalActions;
};

//*************************************************************************************************************
//*************************************************************************************************************

Unit::Unit() :
	position(),
	legalActionsCount(0),
	legalActions(NULL)
{

}

//*************************************************************************************************************
//*************************************************************************************************************

void Unit::initLegalactions(int legalActionsCount) {
	this->legalActionsCount = legalActionsCount;
	legalActions = new Action[legalActionsCount];
}

//*************************************************************************************************************
//*************************************************************************************************************

void Unit::fillActionData(int actionIdx, const char* type, const char* moveDir, const char* buildDir) {
	legalActions[actionIdx].filldata(type, moveDir, buildDir);
}

//*************************************************************************************************************
//*************************************************************************************************************

void Unit::debug() const {
	position.debug();
	for (int actionIdx = 0; actionIdx < legalActionsCount; ++actionIdx) {
		legalActions[actionIdx].debug();
	}
}

//-------------------------------------------------------------------------------------------------------------
//-------------------------------------------------------------------------------------------------------------
//-------------------------------------------------------------------------------------------------------------

class Player {
public:
	Player();
	~Player();

	int getUnitsCount() const {
		return unitsCount;
	}

	void setUnitsCount(int unitsCount) { this->unitsCount = unitsCount; }

	void initUnits(int unitsCount);
	Unit* getUnit(int index) const;

	void debug() const;
private:
	int unitsCount;
	Unit* units;
};

//*************************************************************************************************************
//*************************************************************************************************************

Player::Player() :
	unitsCount(0),
	units(NULL)
{
}

//*************************************************************************************************************
//*************************************************************************************************************

Player::~Player() {
	if (units) {
		delete[] units;
		units = NULL;
	}
}

//*************************************************************************************************************
//*************************************************************************************************************

void Player::initUnits(int unitsCount) {
	this->unitsCount = unitsCount;
	units = new Unit[unitsCount];
}

//*************************************************************************************************************
//*************************************************************************************************************

Unit* Player::getUnit(int index) const {
	return (units + index);
}

//*************************************************************************************************************
//*************************************************************************************************************

void Player::debug() const {
	for (int unitIdx = 0; unitIdx < unitsCount; ++unitIdx) {
		units[unitIdx].debug();
	}
}

//-------------------------------------------------------------------------------------------------------------
//-------------------------------------------------------------------------------------------------------------
//-------------------------------------------------------------------------------------------------------------

class Me : public Player {
public:
private:
};

//-------------------------------------------------------------------------------------------------------------
//-------------------------------------------------------------------------------------------------------------
//-------------------------------------------------------------------------------------------------------------

class Enemy : public Player {
public:
private:
};

//-------------------------------------------------------------------------------------------------------------
//-------------------------------------------------------------------------------------------------------------
//-------------------------------------------------------------------------------------------------------------

class Game {
public:
	Game();
	~Game();

	void initGame();
	void gameLoop();
	void getGameInput();
	void getTurnInput();
	void turnBegin();
	void makeTurn();
	void turnEnd();
	void play();

	void debug() const;

private:
	int turnsCount;
	int size;
	int unitsPerPlayer;

	Me* me;
	Enemy* enemy;
};

//*************************************************************************************************************
//*************************************************************************************************************

Game::Game() :
	turnsCount(0),
	size(0),
	unitsPerPlayer(0)
{
}

//*************************************************************************************************************
//*************************************************************************************************************

Game::~Game() {
	if (me) {
		delete me;
		me = NULL;
	}

	if (enemy) {
		delete enemy;
		enemy = NULL;
	}
}

//*************************************************************************************************************
//*************************************************************************************************************

void Game::initGame() {
	me = new Me();
	enemy = new Enemy();
}

//*************************************************************************************************************
//*************************************************************************************************************

void Game::gameLoop() {
	while (true) {
		getTurnInput();
		turnBegin();
		makeTurn();
		turnEnd();
	}
}

//*************************************************************************************************************
//*************************************************************************************************************

void Game::getGameInput() {
	cin >> size;
	cin >> unitsPerPlayer;

	me->initUnits(unitsPerPlayer);
	enemy->initUnits(unitsPerPlayer);
}

//*************************************************************************************************************
//*************************************************************************************************************

void Game::getTurnInput() {
	for (int i = 0; i < size; i++) {
		string row;
		cin >> row;
	}

	for (int i = 0; i < unitsPerPlayer; i++) {
		int unitX, unitY;
		cin >> unitX >> unitY;
		me->getUnit(i)->setPosition(Coords(unitX, unitY));
	}

	for (int i = 0; i < unitsPerPlayer; i++) {
		int otherX, otherY;
		cin >> otherX >> otherY;
		enemy->getUnit(i)->setPosition(Coords(otherX, otherY));
	}

	int legalActions;
	cin >> legalActions;
	me->getUnit(0)->initLegalactions(legalActions);

	for (int i = 0; i < legalActions; i++) {
		string type, dir1, dir2;
		int index;
		cin >> type >> index >> dir1 >> dir2;
		//cerr << "Legal action: " << " Type:" << type << " Idx:" << index << " Dir1:" << dir1 << " Dir2:" << dir2 << endl;

		me->getUnit(index)->fillActionData(i, type.c_str(), dir1.c_str(), dir2.c_str());
	}
}

//*************************************************************************************************************
//*************************************************************************************************************

void Game::turnBegin() {
}

//*************************************************************************************************************
//*************************************************************************************************************

void Game::makeTurn() {
	cout << "MOVE&BUILD 0 N S" << endl;
}

//*************************************************************************************************************
//*************************************************************************************************************

void Game::turnEnd() {
	++turnsCount;
}

//*************************************************************************************************************
//*************************************************************************************************************

void Game::play() {
	initGame();
	getGameInput();
	gameLoop();
}

//*************************************************************************************************************
//*************************************************************************************************************

void Game::debug() const {
}

//-------------------------------------------------------------------------------------------------------------
//-------------------------------------------------------------------------------------------------------------
//-------------------------------------------------------------------------------------------------------------

#ifdef TESTS
#include "debug.h"
#endif // TESTS

int main(int argc, char** argv) {
#ifdef TESTS
	doctest::Context context;
	int res = context.run();
#else
	Game game;
	game.play();
#endif // TESTS

	return 0;
}

/*
mapIndex=0
seed=313480975
*/